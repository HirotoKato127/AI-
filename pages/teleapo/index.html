<!-- KPI v2: テレアポ管理 -->
<section data-page="teleapo" data-kpi="v2" class="kpi-v2-wrapper space-y-6">

  <!-- ★ 一番上：全体KPIサマリー（通電率・設定率・着座率） -->
  <div class="kpi-v2-section kpi-v2-summary-section">
    <div class="flex items-center justify-between mb-3 gap-2">
      <h3 class="kpi-v2-title" id="teleapoSummaryTitle">
        今月の全体KPI（率）
      </h3>
      <div class="text-xs text-slate-500">
        表示対象：
        <span id="teleapoSummaryScopeLabel" class="font-semibold text-slate-700">全体</span>
        <button type="button" id="teleapoSummaryResetBtn"
          class="ml-2 px-2 py-1 border border-slate-300 rounded-md text-[11px] text-slate-600 hover:bg-slate-100">
          全体に戻す
        </button>
      </div>
    </div>

    <div class="kpi-v2-summary-unified">
      <div class="kpi-v2-achievement-card">
        <div class="kpi-v2-label">通電率</div>
        <div class="kpi-v2-value-large" id="teleapoSummaryConnectRate">50.0%</div>
        <div class="kpi-v2-meta" id="teleapoSummaryConnectMeta">当月・全社員</div>
      </div>
      <div class="kpi-v2-achievement-card">
        <div class="kpi-v2-label">設定率</div>
        <div class="kpi-v2-value-large" id="teleapoSummarySetRate">30.0%</div>
        <div class="kpi-v2-meta" id="teleapoSummarySetMeta">当月・全社員</div>
      </div>
      <div class="kpi-v2-achievement-card">
        <div class="kpi-v2-label">着座率</div>
        <div class="kpi-v2-value-large" id="teleapoSummaryShowRate">82.0%</div>
        <div class="kpi-v2-meta" id="teleapoSummaryShowMeta">当月・全社員</div>
      </div>
    </div>
    <!-- ★ 追加：KPI率の下に、少し小さめの「数値4つ」 -->
    <div class="kpi-v2-summary-counts">
      <div class="kpi-v2-summary-count-item">
        <span class="kpi-v2-summary-count-label">架電数</span>
        <span class="kpi-v2-summary-count-value" id="teleapoSummaryDials">1,247</span>
      </div>
      <div class="kpi-v2-summary-count-item">
        <span class="kpi-v2-summary-count-label">通電数</span>
        <span class="kpi-v2-summary-count-value" id="teleapoSummaryConnects">623</span>
      </div>
      <div class="kpi-v2-summary-count-item">
        <span class="kpi-v2-summary-count-label">設定数</span>
        <span class="kpi-v2-summary-count-value" id="teleapoSummarySets">187</span>
      </div>
      <div class="kpi-v2-summary-count-item">
        <span class="kpi-v2-summary-count-label">着座数</span>
        <span class="kpi-v2-summary-count-value" id="teleapoSummaryShows">154</span>
      </div>
    </div>
  </div>

  <!-- 社内成績 -->
  <!-- 社員成績＋社員別グラフ -->
  <div class="kpi-v2-section">
    <div class="kpi-v2-header">
      <!-- 左側は何も表示しない -->
      <div class="flex-1"></div>
      <!-- 右側に期間（日付）のみ -->
      <div class="kpi-v2-range-picker">
        <input type="date" id="teleapoCompanyRangeStart" class="kpi-v2-date-input" />
        <span class="kpi-v2-date-separator">〜</span>
        <input type="date" id="teleapoCompanyRangeEnd" class="kpi-v2-date-input" />
        <div class="kpi-v2-range-presets" data-scope="company">
          <button type="button" class="kpi-v2-range-btn" data-preset="today">今日</button>
          <button type="button" class="kpi-v2-range-btn" data-preset="thisWeek">今週</button>
          <button type="button" class="kpi-v2-range-btn kpi-v2-range-btn-active" data-preset="thisMonth">今月</button>
        </div>
      </div>
    </div>
    <p class="kpi-v2-period-label" id="teleapoCompanyPeriodLabel"></p>

    <!-- 社員テーブル（検索・ソートは削除） -->
    <div class="kpi-v2-subsection">
      <div id="teleapoEmployeeTableWrapper" class="overflow-auto rounded-lg border border-slate-200 mb-4">
        <table class="table-grid min-w-[800px]">
          <thead>
            <tr>
              <th class="whitespace-nowrap">社員名</th>
              <th class="whitespace-nowrap">架電数</th>
              <th class="whitespace-nowrap">通電数</th>
              <th class="whitespace-nowrap">設定数</th>
              <th class="whitespace-nowrap">着座数</th>
              <th class="whitespace-nowrap">通電率</th>
              <th class="whitespace-nowrap">設定率</th>
              <th class="whitespace-nowrap">着座率</th>
            </tr>
          </thead>
          <tbody id="teleapoEmployeeTableBody">
            <!-- JSで生成 -->
          </tbody>
        </table>
      </div>

      <!-- 社員ごとの時系列グラフ -->
      <div id="teleapoEmployeeChartWrapper" class="hidden border border-slate-200 rounded-lg p-4 bg-white">
        <h5 class="text-sm font-semibold text-slate-800 mb-2" id="teleapoEmployeeChartTitle">
          社員別 時系列KPI
        </h5>
        <div class="w-full overflow-x-auto">
          <svg id="teleapoEmployeeTrendChart" viewBox="0 0 800 260" class="w-full h-auto">
            <!-- JSで描画 -->
          </svg>
        </div>
        <p class="mt-1 text-[11px] text-slate-500">
          ※ 現在はモックの時系列です。本番では日別・週別の実データに差し替え予定。
        </p>
      </div>
    </div>

    <!-- 時間帯×曜日ヒートマップ -->
    <div class="kpi-v2-subsection">
      <h4 class="kpi-v2-subtitle">時間帯 × 曜日ヒートマップ</h4>

      <div class="kpi-v2-filters grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
        <div class="kpi-v2-filter-group">
          <span class="kpi-v2-filter-label">担当者</span>
          <select id="teleapoHeatmapEmployeeFilter" class="kpi-v2-filter-select">
            <option value="all">全体</option>
            <option value="佐藤">佐藤</option>
            <option value="田中">田中</option>
            <option value="山本">山本</option>
            <option value="鈴木">鈴木</option>
          </select>
        </div>
        <div class="kpi-v2-filter-group">
          <span class="kpi-v2-filter-label">指標</span>
          <select id="teleapoHeatmapMetricFilter" class="kpi-v2-filter-select">
            <option value="dials">架電数</option>
            <option value="connects">通電数</option>
            <option value="sets">設定数</option>
            <option value="shows">着座数</option>
          </select>
        </div>
        <div class="kpi-v2-filter-group">
          <span class="kpi-v2-filter-label">凡例</span>
          <div class="flex items-center gap-2 text-[11px] text-slate-500">
            <span class="kpi-v2-heatmap-cell" data-count="0">低</span>
            <span class="kpi-v2-heatmap-cell" data-count="3">中</span>
            <span class="kpi-v2-heatmap-cell" data-count="7">高</span>
          </div>
        </div>
      </div>

      <!-- ヒートマップ本体 -->
      <div class="overflow-auto rounded-lg border border-slate-200 bg-white teleapo-heatmap-wrapper">
        <table class="min-w-[640px] border-collapse text-sm text-slate-700" id="teleapoHeatmapTable">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-3 py-2 border border-slate-200 text-left">時間帯＼曜日</th>
              <th class="px-3 py-2 border border-slate-200 text-center">月</th>
              <th class="px-3 py-2 border border-slate-200 text-center">火</th>
              <th class="px-3 py-2 border border-slate-200 text-center">水</th>
              <th class="px-3 py-2 border border-slate-200 text-center">木</th>
              <th class="px-3 py-2 border border-slate-200 text-center">金</th>
            </tr>
          </thead>
          <tbody id="teleapoHeatmapTableBody">
            <!-- JSで生成 -->
          </tbody>
        </table>
      </div>

      <p id="teleapoHeatmapSelectionLabel" class="mt-2 text-[11px] text-slate-500"></p>
    </div>
  </div>


  <!-- ★ 第3段階追加：時間帯×曜日ヒートマップ -->
  <div class="kpi-v2-subsection">
    <h4 class="kpi-v2-subtitle">時間帯 × 曜日ヒートマップ</h4>

    <!-- フィルタ -->
    <div class="kpi-v2-filters grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
      <div class="kpi-v2-filter-group">
        <span class="kpi-v2-filter-label">担当者</span>
        <select id="teleapoHeatmapEmployeeFilter" class="kpi-v2-filter-select">
          <option value="all">全体</option>
          <option value="佐藤">佐藤</option>
          <option value="田中">田中</option>
          <option value="山本">山本</option>
          <option value="鈴木">鈴木</option>
        </select>
      </div>

      <div class="kpi-v2-filter-group">
        <span class="kpi-v2-filter-label">指標</span>
        <select id="teleapoHeatmapMetricFilter" class="kpi-v2-filter-select">
          <option value="dials">架電数</option>
          <option value="connects">通電数</option>
          <option value="sets">設定数</option>
          <option value="shows">着座数</option>
        </select>
      </div>

      <div class="kpi-v2-filter-group">
        <span class="kpi-v2-filter-label">凡例</span>
        <div class="flex items-center gap-2 text-[11px] text-slate-500">
          <span class="kpi-v2-heatmap-cell" data-count="0">低</span>
          <span class="kpi-v2-heatmap-cell" data-count="3">中</span>
          <span class="kpi-v2-heatmap-cell" data-count="7">高</span>
        </div>
      </div>
    </div>

    <!-- ヒートマップ本体 -->
    <div class="overflow-auto rounded-lg border border-slate-200 bg-white teleapo-heatmap-wrapper">
      <table class="min-w-[640px] border-collapse text-sm text-slate-700" id="teleapoHeatmapTable">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-3 py-2 border border-slate-200 text-left">時間帯＼曜日</th>
            <th class="px-3 py-2 border border-slate-200 text-center">月</th>
            <th class="px-3 py-2 border border-slate-200 text-center">火</th>
            <th class="px-3 py-2 border border-slate-200 text-center">水</th>
            <th class="px-3 py-2 border border-slate-200 text-center">木</th>
            <th class="px-3 py-2 border border-slate-200 text-center">金</th>
          </tr>
        </thead>
        <tbody id="teleapoHeatmapTableBody">
          <!-- JS で生成 -->
        </tbody>
      </table>
    </div>


    <!-- ★ 追加：選択中の説明ラベル -->
    <p id="teleapoHeatmapSelectionLabel" class="mt-2 text-[11px] text-slate-500"></p>
  </div>

  </div>


  <!-- ここで集計期間を表示 -->
  <p class="kpi-v2-period-label" id="teleapoCompanyPeriodLabel"></p>



  <!-- 社員成績 -->
  <div class="kpi-v2-subsection">
    <div class="flex items-center justify-between mb-4">
      <div class="flex items-center gap-3">
        <input type="text" id="teleapoEmployeeSearchInput"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="社員名で検索..." />
        <select id="teleapoEmployeeSortSelect" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
          <option value="name-asc">社員名（昇順）</option>
          <option value="dials-desc">架電数（降順）</option>
          <option value="shows-desc" selected>着座数（降順）</option>
          <option value="connectRate-desc">通電率（降順）</option>
        </select>
      </div>
    </div>

    <!-- テーブル表示 -->
    <div class="overflow-auto rounded-lg border border-slate-200 bg-white teleapo-heatmap-wrapper">
      <table class="min-w-[640px] border-collapse text-sm text-slate-700" id="teleapoHeatmapTable">
        <thead class="bg-slate-50">
          <tr>
            <th class="px-3 py-2 border border-slate-200 text-left">時間帯＼曜日</th>
            <th class="px-3 py-2 border border-slate-200 text-center">月</th>
            <th class="px-3 py-2 border border-slate-200 text-center">火</th>
            <th class="px-3 py-2 border border-slate-200 text-center">水</th>
            <th class="px-3 py-2 border border-slate-200 text-center">木</th>
            <th class="px-3 py-2 border border-slate-200 text-center">金</th>
          </tr>
        </thead>
        <tbody id="teleapoHeatmapTableBody">
          <!-- JSで生成 -->
        </tbody>
      </table>
    </div>

  </div>
  </div>
</section>

<!-- 架電ログ -->
<div class="section-shell space-y-4">
  <div class="flex items-center justify-between">
    <h3 class="text-lg font-semibold text-slate-800 whitespace-nowrap">架電ログ</h3>
    <div class="flex items-center gap-2">
      <input type="date" id="teleapoLogRangeStart"
        class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
      <span class="text-slate-500">〜</span>
      <input type="date" id="teleapoLogRangeEnd"
        class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" />
    </div>
  </div>

  <!-- フィルタと検索 -->
  <div class="border border-slate-200 rounded-lg p-4 bg-slate-50 space-y-3">
    <h4 class="text-sm font-semibold text-slate-700">絞り込み条件</h4>
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 text-xs text-slate-500">
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">担当者</label>
        <select id="teleapoLogEmployeeFilter" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
          <option value="">全員</option>
          <option value="佐藤">佐藤</option>
          <option value="田中">田中</option>
          <option value="山本">山本</option>
          <option value="鈴木">鈴木</option>
        </select>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">アポ結果</label>
        <select id="teleapoLogResultFilter" class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm">
          <option value="">全て</option>
          <option value="通電">通電</option>
          <option value="不在">不在</option>
          <option value="設定">設定</option>
          <option value="着座">着座</option>
          <option value="コールバック">コールバック</option>
        </select>
      </div>
      <div class="flex flex-col gap-1">
        <label class="text-xs font-semibold text-slate-500">相手名検索</label>
        <input type="text" id="teleapoLogTargetSearch"
          class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" placeholder="相手名で検索..." />
      </div>
      <div class="flex items-end gap-2">
        <button id="teleapoLogFilterReset"
          class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 whitespace-nowrap">
          条件をクリア
        </button>
        <div id="teleapoLogFilterCount" class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded text-xs font-semibold">
          0件
        </div>
      </div>
    </div>
  </div>

  <!-- ログテーブル -->
  <div class="overflow-auto rounded-lg border border-slate-200">
    <table class="table-grid min-w-[1200px]" id="teleapoLogTable">
      <thead>
        <tr>
          <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="datetime">
            日時
            <span class="ml-1 text-xs text-slate-400">▼</span>
          </th>
          <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="employee">担当者</th>
          <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="target">相手</th>
          <th>電話番号</th>
          <th>メールアドレス</th>
          <th class="cursor-pointer hover:bg-slate-100 sortable" data-sort="result">アポ結果</th>
          <th>メモ</th>
        </tr>
      </thead>
      <tbody id="teleapoLogTableBody">
        <!-- ここは既存のサンプル行のままでOK -->
        <tr>
          <td class="whitespace-nowrap">2024/11/13 10:30</td>
          <td>佐藤</td>
          <td>ABC社 田中様</td>
          <td>03-1234-5678</td>
          <td>tanaka@abc-corp.co.jp</td>
          <td>
            <span class="px-2 py-1 bg-emerald-100 text-emerald-700 rounded text-xs font-semibold">設定</span>
          </td>
          <td>一次面談→11/20 15:00設定</td>
        </tr>
        <tr>
          <td class="whitespace-nowrap">2024/11/13 11:45</td>
          <td>田中</td>
          <td>XYZ社 鈴木様</td>
          <td>03-9876-5432</td>
          <td>suzuki@xyz-inc.co.jp</td>
          <td>
            <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-semibold">通電</span>
          </td>
          <td>一次日程打診中</td>
        </tr>
        <tr>
          <td class="whitespace-nowrap">2024/11/13 13:20</td>
          <td>山本</td>
          <td>DEF社 佐々木様</td>
          <td>03-5555-1111</td>
          <td>sasaki@def-ltd.co.jp</td>
          <td>
            <span class="px-2 py-1 bg-slate-100 text-slate-600 rounded text-xs font-semibold">不在</span>
          </td>
          <td>再架電予定 11/14</td>
        </tr>
        <tr>
          <td class="whitespace-nowrap">2024/11/13 14:15</td>
          <td>鈴木</td>
          <td>GHI株式会社 高橋様</td>
          <td>03-2222-9999</td>
          <td>takahashi@ghi-group.com</td>
          <td>
            <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs font-semibold">着座</span>
          </td>
          <td>面談完了、次回フォローアップ予定</td>
        </tr>
        <tr>
          <td class="whitespace-nowrap">2024/11/13 15:30</td>
          <td>佐藤</td>
          <td>JKL商事 山田様</td>
          <td>03-7777-3333</td>
          <td>yamada@jkl-trading.jp</td>
          <td>
            <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs font-semibold">コールバック</span>
          </td>
          <td>16:00に折り返し予定</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ページネーション -->
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2 text-sm text-slate-500">
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="teleapoLogPrevBtn" disabled>
        前のページ
      </button>
      <span class="px-3 py-2 text-sm" id="teleapoLogPageInfo">1 / 1</span>
      <button
        class="px-3 py-2 border border-slate-300 rounded-md text-sm hover:bg-slate-100 disabled:opacity-50 disabled:cursor-not-allowed"
        id="teleapoLogNextBtn" disabled>
        次のページ
      </button>
    </div>
    <div class="flex items-center gap-2 text-sm">
      <label class="text-xs text-slate-500">表示件数</label>
      <select class="bg-white border border-slate-300 rounded-md px-3 py-2 text-sm" id="teleapoLogPageSize">
        <option value="25">25件</option>
        <option value="50" selected>50件</option>
        <option value="100">100件</option>
      </select>
    </div>
  </div>
</div>